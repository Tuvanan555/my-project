<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Artis ‚Äî Curated Luxury Auctions (1900‚Äì1985)</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Great+Vibes&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --ivory:#fffdf8; --cream:#f6efe8; --gold:#c79b3a; --rich-navy:#07203a; --muted-gray:#8f847d;
      --card-shadow: 0 18px 50px rgba(7,32,58,0.12);
      --glass: linear-gradient(135deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
      --accent: rgba(199,155,58,0.12);
      --radius:14px; --ease: cubic-bezier(.2,.9,.24,1);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:'Inter',system-ui,Arial; background:linear-gradient(180deg,var(--ivory),#f7f5f2); color:var(--rich-navy); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; line-height:1.45}

    /* layout container */
    .wrap{max-width:1200px; margin:30px auto; padding:0 20px}

    /* header */
    header{display:flex; align-items:center; justify-content:space-between; gap:16px}
    .brand-box{display:flex; gap:12px; align-items:center}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,#fffaf0,#f3f6ff);display:flex;align-items:center;justify-content:center;border:1px solid rgba(7,32,58,0.04);font-size:28px}
    .brand-title{display:flex; flex-direction:column}
    .brand-title .script{font-family:'Great Vibes',serif; font-size:28px; color:var(--rich-navy); line-height:1}
    .brand-title .name{font-family:'Playfair Display',serif; font-size:13px; letter-spacing:2px; font-weight:700}

    nav{display:flex; gap:10px; align-items:center}
    .search{padding:10px 12px;border-radius:10px;border:1px solid rgba(7,32,58,0.06);min-width:220px}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(7,32,58,0.06); background:transparent; cursor:pointer}
    .btn.primary{background:var(--rich-navy); color:var(--ivory); border:0}

    /* hero */
    .hero{margin-top:18px;display:grid; grid-template-columns:1fr 340px; gap:20px; align-items:stretch}
    .card-hero{background:var(--glass); border-radius:var(--radius); padding:28px; box-shadow:var(--card-shadow); border:1px solid rgba(7,32,58,0.04)}
    .hero-title{font-family:'Playfair Display',serif;font-size:44px;margin:0}
    .hero-sub{color:var(--muted-gray); margin-top:8px}
    .hero-actions{margin-top:18px;display:flex;gap:10px}

    .mini-card{background:linear-gradient(180deg,#fff,#f9f6ef); padding:16px;border-radius:12px; box-shadow:0 14px 36px rgba(7,32,58,0.06);}
    .countdown-strong{font-weight:800; font-size:20px}

    /* filters & toolbar */
    .toolbar{display:flex; gap:12px; align-items:center; margin:22px 0}
    .select, .small-input{padding:10px;border-radius:10px;border:1px solid rgba(7,32,58,0.06)}
    .spacer{flex:1}

    /* gallery */
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:18px}
    .tile{background:var(--glass); border-radius:12px; overflow:hidden; box-shadow:var(--card-shadow); border:1px solid rgba(7,32,58,0.04); transition:transform .35s var(--ease), box-shadow .35s var(--ease); will-change:transform}
    .tile:hover{transform:translateY(-10px); box-shadow:0 36px 100px rgba(7,32,58,0.16)}
    .tile .media{aspect-ratio:4/3; background:#f3f7fb; display:flex; align-items:center; justify-content:center; position:relative}
    .tile img{width:100%; height:100%; object-fit:cover; display:block}
    .tile .meta{padding:14px}
    .title-sm{font-family:'Playfair Display',serif; margin:0;font-size:16px}
    .subtitle-sm{color:var(--muted-gray); margin-top:6px;font-size:13px}
    .tile .row{display:flex; justify-content:space-between; align-items:center; margin-top:12px}
    .price{font-weight:800; font-size:16px}
    .controls-vertical{display:flex;flex-direction:column; gap:8px}

    .badge{position:absolute; left:12px; top:12px; background:var(--rich-navy); color:white; padding:6px 8px; border-radius:10px; font-size:12px}

    /* modal */
    .modal-backdrop{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(2,8,15,0.5); z-index:300}
    .modal-panel{width:100%; max-width:980px; background:var(--ivory); border-radius:12px; box-shadow:0 48px 140px rgba(7,32,58,0.6); overflow:hidden}
    .modal-grid{display:grid; grid-template-columns:1fr 380px}
    .modal-media{min-height:520px; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#f7fbff,#ffffff);}
    .modal-side{padding:22px}
    .muted{color:var(--muted-gray)}
    .bid-row{display:flex; gap:10px; margin-top:12px}
    .bid-row input{width:160px;padding:10px;border-radius:8px;border:1px solid rgba(7,32,58,0.06)}

    /* admin floating */
    .admin{position:fixed; right:22px; bottom:22px; background:var(--ivory); border-radius:12px; padding:12px; box-shadow:var(--card-shadow); border:1px solid rgba(7,32,58,0.06)}

    /* toast */
    .toast{position:fixed; right:22px; top:22px; z-index:800}
    .toast .item{background:var(--rich-navy); color:white; padding:10px 14px; border-radius:8px; margin-bottom:8px; box-shadow:0 10px 30px rgba(7,32,58,0.12); opacity:1; transition:opacity .4s}

    /* subtle animations */
    @keyframes fadeInUp{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
    .tile{animation:fadeInUp .5s ease both}

    /* accessibility focus */
    .btn:focus, input:focus, select:focus, button:focus{outline:3px solid rgba(199,155,58,0.16); outline-offset:2px}

    /* responsive */
    @media (max-width:980px){ .hero{grid-template-columns:1fr} .modal-grid{grid-template-columns:1fr} }
    @media (max-width:560px){ .search{min-width:120px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand-box">
        <div class="logo" aria-hidden="true">üé®</div>
        <div class="brand-title">
          <div class="script">Chisanapong</div>
          <div class="name">THE ARTIS ‚Äî Curated Auction House</div>
        </div>
      </div>

      <nav>
        <input id="search" class="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: Portrait)" aria-label="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤" />
        <button class="btn" id="filterBtn">‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå</button>
        <button class="btn primary" id="joinBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•</button>
        <button class="btn" id="loginBtn">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</button>
      </nav>
    </header>

    <section class="hero">
      <div class="card-hero">
        <h1 class="hero-title">Curated Art & Auctions (1900‚Äì1985)</h1>
        <p class="hero-sub">A private salon for collectors and patrons ‚Äî curated, authenticated and offered for exclusive bidding. Timeless works from the 20th century presented with provenance and refinement.</p>
        <div class="hero-actions">
          <button class="btn primary" id="viewAuctions">‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button class="btn" id="exploreBtn">‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô</button>
        </div>
        <div style="margin-top:18px; display:flex; gap:12px">
          <div style="flex:1;" class="mini-card">
            <div style="font-size:13px;color:var(--muted-gray)">Featured This Week</div>
            <div style="font-weight:800;margin-top:6px">Modern Masters ‚Äî Evening Sale</div>
            <div style="color:var(--muted-gray); margin-top:8px">Starts in</div>
            <div class="countdown-strong" id="globalCount">--:--:--</div>
          </div>
          <div style="width:260px" class="mini-card">
            <div style="font-size:13px;color:var(--muted-gray)">For Patrons</div>
            <div style="margin-top:8px">Access private previews, condition reports and concierge bidding.</div>
          </div>
        </div>
      </div>

      <aside>
        <div class="mini-card">
          <div style="font-weight:700">Upcoming Live</div>
          <div style="color:var(--muted-gray); margin-top:6px">Evening Sale ‚Äî 120 lots</div>
          <div style="margin-top:10px; font-weight:800">Starts in <span id="asideCount">--:--:--</span></div>
        </div>
      </aside>
    </section>

    <div class="toolbar">
      <select id="yearFilter" class="select" aria-label="‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏µ">
        <option value="all">1900‚Äì1985 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        <option value="1900-1919">1900‚Äì1919</option>
        <option value="1920-1939">1920‚Äì1939</option>
        <option value="1940-1959">1940‚Äì1959</option>
        <option value="1960-1979">1960‚Äì1979</option>
        <option value="1980-1985">1980‚Äì1985</option>
      </select>

      <select id="sortBy" class="select" aria-label="‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö">
        <option value="endsSoon">‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</option>
        <option value="priceDesc">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏™‡∏π‡∏á ‚Üí ‡∏ï‡πà‡∏≥</option>
        <option value="priceAsc">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ï‡πà‡∏≥ ‚Üí ‡∏™‡∏π‡∏á</option>
      </select>

      <button id="upcomingBtn" class="btn">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•</button>

      <div class="spacer"></div>
      <div style="color:var(--muted-gray)">‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong id="totalCount">0</strong></div>
    </div>

    <main class="grid" id="gallery" aria-live="polite"></main>

    <footer style="margin-top:34px; text-align:center; color:var(--muted-gray);">¬© THE ARTIS ‚Ä¢ Curated Auction House ‚Äî 1900‚Äì1985</footer>

  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-hidden="true">
    <div class="modal-panel" role="document">
      <div class="modal-grid">
        <div class="modal-media" id="modalPreview">Preview</div>
        <div class="modal-side">
          <h2 id="modalTitle">Title</h2>
          <div class="muted" id="modalMeta">Artist ‚Ä¢ Year</div>
          <p class="muted" id="modalDesc">Description</p>

          <div style="margin-top:14px">
            <div style="display:flex; justify-content:space-between; align-items:center">
              <div>
                <div class="muted">‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
                <div class="price" id="currentPrice">‡∏ø0</div>
              </div>
              <div style="text-align:right">
                <div class="muted">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                <div id="countdown" style="font-weight:800; font-size:18px">--:--:--</div>
              </div>
            </div>

            <div class="bid-row">
              <input id="bidAmount" type="number" placeholder="‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)" aria-label="‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤">
              <button id="placeBid" class="btn primary">‡πÄ‡∏™‡∏ô‡∏≠</button>
            </div>

            <div style="margin-top:12px">
              <strong>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏ô‡∏≠</strong>
              <div id="historyList" style="max-height:120px; overflow:auto; margin-top:6px; color:var(--muted-gray)">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ</div>
            </div>

            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:16px">
              <button id="closeModal" class="btn">‡∏õ‡∏¥‡∏î</button>
              <button id="checkoutNow" class="btn primary">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin" id="adminPanel" aria-hidden="true">
    <button class="btn primary" id="openAdd">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
    <button class="btn" id="openManage">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•</button>
    <button class="btn" id="logoutAdmin">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>

  <!-- ADMIN MODAL -->
  <div class="modal-backdrop" id="adminModalBackdrop" aria-hidden="true">
    <div class="modal-panel">
      <div style="padding:18px">
        <h3 id="adminModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
        <div style="display:flex; gap:12px; margin-top:10px; flex-wrap:wrap">
          <input id="artTitle" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏á‡∏≤‡∏ô" style="flex:1">
          <input id="artArtist" placeholder="‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô" style="width:240px">
          <input id="artYear" placeholder="‡∏õ‡∏µ" style="width:120px" type="number">
        </div>
        <textarea id="artDesc" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢" style="margin-top:10px; width:100%; min-height:80px"></textarea>
        <div style="display:flex; gap:10px; margin-top:10px; align-items:center">
          <label style="font-size:13px; color:var(--muted-gray)">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ</label>
          <input id="artImage" type="file" accept="image/*">
          <input id="startPrice" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ø)" style="width:180px">
          <input id="endsInHours" type="number" placeholder="‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ä‡∏°.)" style="width:140px" value="24">
        </div>
        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px">
          <button id="cancelAdd" class="btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button id="saveAdd" class="btn primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" aria-live="polite"></div>

  <script>
    /* ------------------ Enhanced app logic v2 ------------------ */
    // curated dataset
    let artworks = [
      {id:1,title:'Morning Harvest',artist:'S. Kittikun',year:1906,thumb:'assets/sample1.jpg',desc:'‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏ö‡∏ô‡∏ú‡πâ‡∏≤‡πÉ‡∏ö 82x60 cm.'},
      {id:2,title:'Blue Harbor',artist:'A. Wichai',year:1922,thumb:'assets/sample2.jpg',desc:'‡∏≠‡∏∞‡∏Ñ‡∏£‡∏µ‡∏•‡∏¥‡∏Ñ, limited'},
      {id:3,title:'Portrait of Lady M',artist:'E. Ratanapong',year:1948,thumb:'assets/sample3.jpg',desc:'‡∏û‡∏≠‡∏£‡πå‡πÄ‡∏ó‡∏£‡∏ï‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ô‡∏µ‡πÇ‡∏≠‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Ñ'},
      {id:4,title:'Midnight Sonata',artist:'C. Somchai',year:1965,thumb:'assets/sample4.jpg',desc:'mixed media, unique'},
      {id:5,title:'Industrial Dawn',artist:'O. Thanapol',year:1974,thumb:'assets/sample5.jpg',desc:'graphic print'},
      {id:6,title:'Last Light',artist:'N. Ploy',year:1982,thumb:'assets/sample6.jpg',desc:'watercolor on paper'}
    ];

    // auctions runtime
    const auctions = {};
    function seedAuctions(){ artworks.forEach(a=>{ const start = Math.round((Math.random()*40 + 30) * 1000); auctions[a.id] = {highest:start, history:[{who:'Initial',amount:start,time:Date.now()}], endsAt: Date.now() + (Math.random()*36+6)*3600000}; }); }
    seedAuctions();

    /* helpers & accessibility */
    const el = s => document.querySelector(s); const els = s => Array.from(document.querySelectorAll(s));
    function formatMoney(n){ return '‡∏ø'+n.toLocaleString(); }
    function toast(msg, time=3000){ const t = document.createElement('div'); t.className='item'; t.textContent = msg; el('#toast').appendChild(t); setTimeout(()=>{ t.style.opacity=0; setTimeout(()=>t.remove(),400); }, time); }
    function escape(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    /* render */
    const gallery = el('#gallery'); const totalCount = el('#totalCount');
    function placeholder(){ return 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><rect width="100%" height="100%" fill="#f3f7fb"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9aa" font-size="24">No image</text></svg>'); }

    function createTile(a){ const div = document.createElement('article'); div.className='tile'; div.innerHTML = `
      <div class="media">
        ${a.thumb?`<img loading="lazy" src="${escape(a.thumb)}" alt="${escape(a.title)}">`:`<img loading="lazy" src="${placeholder()}" alt="no image">`}
        <div class="badge">${a.year}</div>
      </div>
      <div class="meta">
        <h3 class="title-sm">${escape(a.title)}</h3>
        <div class="subtitle-sm">${escape(a.artist)}</div>
        <div class="row">
          <div>
            <div class="muted">‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
            <div class="price">${formatMoney(auctions[a.id].highest)}</div>
          </div>
          <div class="controls-vertical">
            <button class="btn" onclick="openModal(${a.id})">‡∏î‡∏π</button>
            <button class="btn primary" onclick="openModal(${a.id}, true)">‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•</button>
          </div>
        </div>
      </div>
    `; return div; }

    function renderGrid(list=artworks){ gallery.innerHTML=''; list.forEach(a=>gallery.appendChild(createTile(a))); totalCount.textContent = list.length; }
    renderGrid();

    /* filters */
    el('#search').addEventListener('input', debounce(()=>applyFilters(), 220));
    el('#yearFilter').addEventListener('change', applyFilters);
    el('#sortBy').addEventListener('change', applyFilters);
    el('#upcomingBtn').addEventListener('click', ()=>{ const soon = artworks.slice().sort((a,b)=>auctions[a.id].endsAt - auctions[b.id].endsAt).slice(0,6); renderGrid(soon); toast('‡πÅ‡∏™‡∏î‡∏á 6 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î'); });

    function applyFilters(){ const q = el('#search').value.trim().toLowerCase(); const yf = el('#yearFilter').value; const sortBy = el('#sortBy').value; let list = artworks.filter(a=>{ if(q && !(a.title.toLowerCase().includes(q) || a.artist.toLowerCase().includes(q) || String(a.year).includes(q))) return false; if(yf!=='all'){ const [min,max] = yf.split('-').map(Number); if(a.year < min || a.year > max) return false; } return true; }); if(sortBy==='priceDesc') list.sort((x,y)=>auctions[y.id].highest - auctions[x.id].highest); if(sortBy==='priceAsc') list.sort((x,y)=>auctions[x.id].highest - auctions[y.id].highest); if(sortBy==='endsSoon') list.sort((x,y)=>auctions[x.id].endsAt - auctions[y.id].endsAt); renderGrid(list); }

    /* modal & bidding (improved) */
    const modalBackdrop = el('#modalBackdrop'); const modalPreview = el('#modalPreview'); const modalTitle = el('#modalTitle'); const modalMeta = el('#modalMeta'); const modalDesc = el('#modalDesc'); const currentPrice = el('#currentPrice'); const countdown = el('#countdown'); const historyList = el('#historyList'); const bidAmount = el('#bidAmount');
    let currentId = null; let countdownTimer = null; let focusableElements = [];

    window.openModal = function(id, focusBid=false){ const art = artworks.find(x=>x.id===id); if(!art) return; currentId=id; modalPreview.innerHTML = art.thumb?`<img src="${escape(art.thumb)}" style="max-width:100%; max-height:100%; object-fit:contain">`:`<img src="${placeholder()}" style="max-width:100%; max-height:100%; object-fit:contain">`; modalTitle.textContent = art.title; modalMeta.textContent = `${art.artist} ‚Ä¢ ${art.year}`; modalDesc.textContent = art.desc; updateAuctionDetails(); openModalUI(); if(focusBid) setTimeout(()=>bidAmount.focus(),220); }

    function openModalUI(){ modalBackdrop.style.display='flex'; modalBackdrop.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; // trap focus
      focusableElements = Array.from(modalBackdrop.querySelectorAll('button,input,select,textarea,a[href]')).filter(e=>!e.disabled);
      if(focusableElements.length) focusableElements[0].focus(); }

    function closeModal(){ modalBackdrop.style.display='none'; modalBackdrop.setAttribute('aria-hidden','true'); document.body.style.overflow='auto'; stopCountdown(); }
    el('#closeModal').addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', (e)=>{ if(e.target===modalBackdrop) closeModal(); });
    // keyboard support
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Escape'){ if(modalBackdrop.style.display==='flex') closeModal(); }
      if(e.key==='Tab' && modalBackdrop.style.display==='flex'){ // focus trap
        const idx = focusableElements.indexOf(document.activeElement); if(e.shiftKey && idx===0){ e.preventDefault(); focusableElements[focusableElements.length-1].focus(); } else if(!e.shiftKey && idx===focusableElements.length-1){ e.preventDefault(); focusableElements[0].focus(); }
      }
    });

    function updateAuctionDetails(){ if(!currentId) return; const a = auctions[currentId]; currentPrice.textContent = formatMoney(a.highest); renderHistory(a.history); startCountdown(a.endsAt); }
    function renderHistory(h){ if(!h||h.length===0){ historyList.textContent='‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ'; return; } historyList.innerHTML = h.slice().reverse().map(x=>`<div style="padding:6px 0">${new Date(x.time).toLocaleString()} ‚Äî <strong>${escape(x.who)}</strong> : ${formatMoney(x.amount)}</div>`).join(''); }

    function startCountdown(endsAt){ stopCountdown(); function tick(){ const delta = Math.max(0, endsAt - Date.now()); const hrs = Math.floor(delta/3600000); const mins = Math.floor((delta%3600000)/60000); const secs = Math.floor((delta%60000)/1000); countdown.textContent = `${String(hrs).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`; if(delta<=0){ clearInterval(countdownTimer); countdownTimer=null; countdown.textContent='‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß'; toast('‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß'); } } tick(); countdownTimer = setInterval(tick, 1000); }
    function stopCountdown(){ if(countdownTimer) clearInterval(countdownTimer); countdownTimer=null }

    el('#placeBid').addEventListener('click', ()=>{ const val = Number(bidAmount.value); if(!val || !currentId) return toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà'); const minNext = auctions[currentId].highest + Math.max(100, Math.round(auctions[currentId].highest*0.03)); if(val < minNext) return toast(`‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Ñ‡∏∑‡∏≠ ${formatMoney(minNext)}`); const who = prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏• (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)') || 'Anonymous'; addBid(currentId, who, val); bidAmount.value=''; updateAuctionDetails(); renderGrid(); toast('‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); });

    function addBid(id, who, amount){ auctions[id].highest = amount; auctions[id].history.push({who,amount,time:Date.now()}); const remaining = auctions[id].endsAt - Date.now(); if(remaining < 60*1000) auctions[id].endsAt += 2*60*1000; }

    /* checkout (mock) */
    el('#checkoutNow').addEventListener('click', ()=>{ if(!currentId) return; const a = auctions[currentId]; const last = a.history[a.history.length-1]; if(!last) return; const ok = confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞ ${formatMoney(last.amount)} ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${escape(artworks.find(x=>x.id===currentId).title)} ? (‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)`); if(ok) toast('‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‚Äî ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á'); });

    /* admin */
    const adminPanel = el('#adminPanel'); const adminModalBackdrop = el('#adminModalBackdrop'); const openAdd = el('#openAdd'); const saveAdd = el('#saveAdd'); const cancelAdd = el('#cancelAdd');
    openAdd.addEventListener('click', ()=>{ adminModalBackdrop.style.display='flex'; adminModalBackdrop.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; el('#adminModalTitle').textContent='‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà'; });
    cancelAdd.addEventListener('click', ()=>{ adminModalBackdrop.style.display='none'; adminModalBackdrop.setAttribute('aria-hidden','true'); document.body.style.overflow='auto'; });

    let pendingImageData = null;
    el('#artImage').addEventListener('change', (e)=>{ const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ()=>{ pendingImageData = reader.result; toast('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }; reader.readAsDataURL(f); });

    el('#saveAdd').addEventListener('click', ()=>{ const title = el('#artTitle').value.trim(); const artist = el('#artArtist').value.trim(); const year = Number(el('#artYear').value); const desc = el('#artDesc').value.trim(); const start = Number(el('#startPrice').value) || 1000; const hours = Number(el('#endsInHours').value) || 24; if(!title||!artist||!year) return toast('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); const id = Date.now(); const thumb = pendingImageData || ''; const newArt = {id,title,artist,year,thumb,desc}; artworks.unshift(newArt); auctions[newArt.id] = {highest:start, history:[{who:'Initial',amount:start,time:Date.now()}], endsAt: Date.now() + hours*3600000}; el('#artTitle').value=''; el('#artArtist').value=''; el('#artYear').value=''; el('#artDesc').value=''; el('#startPrice').value=''; el('#artImage').value=''; pendingImageData=null; adminModalBackdrop.style.display='none'; adminModalBackdrop.setAttribute('aria-hidden','true'); document.body.style.overflow='auto'; renderGrid(); toast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (local only)'); });

    el('#openManage').addEventListener('click', ()=>{ const list = artworks.map(a=>`${a.id} | ${a.title} | ${a.artist} | ${a.year} | ${formatMoney(auctions[a.id].highest)}`).join(''); prompt('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ‚Äî ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ', list); });

    /* login (mock) */
    let isAdmin = false; adminPanel.style.display='none';
    el('#loginBtn').addEventListener('click', ()=>{ const pw = prompt('‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô'); if(pw==='artis-admin'){ isAdmin=true; adminPanel.style.display='block'; toast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß (‡∏ó‡∏î‡∏•‡∏≠‡∏á)'); } else toast('‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); });
    el('#logoutAdmin').addEventListener('click', ()=>{ isAdmin=false; adminPanel.style.display='none'; toast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö'); });

    /* global countdowns */
    const globalEnds = Date.now() + 12*3600000; function tickGlobal(){ const d = Math.max(0, globalEnds - Date.now()); const h=Math.floor(d/3600000), m=Math.floor((d%3600000)/60000), s=Math.floor((d%60000)/1000); el('#globalCount').textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; el('#asideCount').textContent = el('#globalCount').textContent; } setInterval(tickGlobal,1000); tickGlobal();

    /* persistence */
    window.addEventListener('beforeunload', ()=>{ try{ localStorage.setItem('artworks', JSON.stringify(artworks)); localStorage.setItem('auctions', JSON.stringify(auctions)); }catch(e){} }); (function restore(){ try{ const raw = localStorage.getItem('artworks'); const raw2 = localStorage.getItem('auctions'); if(raw) artworks = JSON.parse(raw); if(raw2) Object.assign(auctions, JSON.parse(raw2)); renderGrid(); }catch(e){} })();

    /* utilities */
    function debounce(fn, ms=200){ let t; return function(){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,arguments), ms); } }
  </script>
</body>
</html>
